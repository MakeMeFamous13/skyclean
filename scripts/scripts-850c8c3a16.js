"use strict";angular.module("becleanApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ui.router","ui.mask","ngStorage","ngVidBg"]).constant("API","http://teenagers.ideasoft.io/api/").config(["$stateProvider","$urlRouterProvider",function(e,r){e.state({url:"/",name:"home",templateUrl:"views/main.html",controller:"MainCtrl",cache:!0}).state({url:"/check-sms",name:"check-sms",templateUrl:"views/check-phone.html",controller:"SmsCtrl",cache:!0,params:{data:{value:{}}}}).state({url:"/confirm",name:"confirm",templateUrl:"views/order-confirm.html",controller:"orderConfirmController",cache:!0,params:{data:{value:{}}}}).state({url:"/checkout",name:"checkout",templateUrl:"views/order-checkout.html",controller:"orderCheckoutController",cache:!0,params:{data:{value:{}}}}).state({url:"/finish",name:"finish",templateUrl:"views/finish.html",controller:"FinishController",cache:!0,params:{data:{value:{}}}}),r.otherwise("/")}]).run(["$rootScope","HttpService",function(e,r){r.price().then(function(r){e.price=r,console.log(e.price)},function(e){console.error(e)})}]),angular.module("becleanApp").service("ScrollToService",function(){this.scrollTo=function(e){function r(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function o(e){for(var r=document.getElementById(e),o=r.offsetTop,t=r;t.offsetParent&&t.offsetParent!=document.body;)t=t.offsetParent,o+=t.offsetTop;return o}var t=r(),n=o(e),c=n>t?n-t:t-n;if(c<100)return void scrollTo(0,n);var a=Math.round(c/100);a>=20&&(a=20);var l=Math.round(c/25),s=n>t?t+l:t-l,i=0;if(n>t)for(var u=t;u<n;u+=l)setTimeout("window.scrollTo(0, "+s+")",i*a),s+=l,s>n&&(s=n),i++;else for(var u=t;u>n;u-=l)setTimeout("window.scrollTo(0, "+s+")",i*a),s-=l,s<n&&(s=n),i++}}),angular.module("becleanApp").factory("HttpService",["$http","$q","$resource","API","transformRequestAsFormPost",function(e,r,o,t,n){function c(){var e=r.defer();return u.home.query().$promise.then(function(r){e.resolve(r)},function(r){console.error(r),e.reject(r)}),e.promise}function a(e){var o=r.defer();return e.phone=e.phone,e.time=+e.time,e.total=+e.total,console.log(e),u.order.query(e).$promise.then(function(e){o.resolve(e)},function(e){console.error(e),o.reject(e)}),o.promise}function l(e,o){var t=r.defer(),n={phone:e,password:o};return u.send_sms.query(n).$promise.then(function(e){t.resolve(e)},function(e){console.error(e),t.reject(e)}),t.promise}function s(e,o){var t=r.defer(),n={phone:e,password:o};return u.check_sms.query(n).$promise.then(function(e){t.resolve(e)},function(e){console.error(e),t.reject(e)}),t.promise}function i(){var e=r.defer();return u.price.query().$promise.then(function(r){for(var o={},t=0;t<r.length;t++)o[r[t].alt_name]={},o[r[t].alt_name].time=r[t].time,o[r[t].alt_name].cost=r[t].price;e.resolve(o)},function(r){console.error(r),e.reject(r)}),e.promise}var u={check_sms:o(t+"pages/phone/validate",{},{query:{method:"POST",isArray:!1},transformRequest:function(e){return angular.toJson(e)}}),order:o(t+"pages/order",{},{query:{method:"POST",isArray:!1}}),home:o(t+"pages/main/content/all",{},{query:{method:"GET",cache:!0,isArray:!1}}),send_sms:o(t+"pages/phone/:phone",{phone:"@phone"},{query:{method:"GET",cache:!0,isArray:!1}}),price:o(t+"pages/prices/all",{},{query:{method:"GET",cache:!0,isArray:!0}})};return{whatWeDo:c,price:i,sendSms:l,checkSms:s,order:a}}]),angular.module("becleanApp").factory("transformRequestAsFormPost",function(){function e(e,o){var t=o();return t["Content-type"]="application/x-www-form-urlencoded; charset=utf-8",r(e)}function r(e){if(!angular.isObject(e))return null==e?"":e.toString();var r=[];for(var o in e)if(e.hasOwnProperty(o)){var t=e[o];r.push(encodeURIComponent(o)+"="+encodeURIComponent(null==t?"":t))}var n=r.join("&").replace(/%20/g,"+");return n}return e}),angular.module("becleanApp").controller("MainCtrl",["$scope","$state","$location","$localStorage","ScrollToService","HttpService",function(e,r,o,t,n,c){e.general={template:{url:"/templates/intro.html"},rooms:{1:"1 комната",2:"2 комнаты",3:"3 комнаты",4:"4 комнаты",5:"5 комнат"},bathrooms:{1:"1 санузел",2:"2 санузла",3:"3 санузла",4:"4 санузла",5:"5 санузлов"},amount:{rooms:1,bathrooms:1},current:{rooms:1,bathrooms:1}},e.increment=function(r){5!=e.general.current[r]&&(e.general.current[r]++,e.general.amount[r]++,e.general.total.price+=e.general.price[r],e.general.total.time+=e.general.time[r])},e.decrement=function(r){1!=e.general.current[r]&&(e.general.current[r]--,e.general.amount[r]--,e.general.total.price-=e.general.price[r],e.general.total.time-=e.general.time[r])},e.submitFirstStep=function(o){o.preventDefault(),console.log(e.price),e.general.price={bathrooms:e.price.bathrooms.cost,rooms:e.price.rooms.cost},e.general.time={bathrooms:e.price.bathrooms.time,rooms:e.price.rooms.time},e.general.total={price:e.general.price.rooms*e.general.current.rooms+e.general.price.bathrooms*e.general.current.bathrooms,time:e.general.time.rooms*e.general.current.rooms+e.general.time.bathrooms*e.general.current.bathrooms},c.sendSms("380"+e.general.phone).then(function(o){e.general.phone="380"+e.general.phone,t.general=e.general;var n={data:t.general};r.go("check-sms",n)},function(e){console.log(e)})},e.goToCheckout=function(){},e.gotoSecond=function(e){o.hash("second"),n.scrollTo(e)},e.setActive=function(r){e.activeButton=r},c.whatWeDo().then(function(r){var o={cleaningTrifles:{sideA:[],sideB:[]},whatWeDo:[],whatWeDoNot:{sideA:[],sideB:[]}};r.cleaningTrifles.reverse();for(var t=0;t<r.cleaningTrifles.length;t++)t+1<=r.cleaningTrifles.length/2?o.cleaningTrifles.sideA.push(r.cleaningTrifles[t]):o.cleaningTrifles.sideB.push(r.cleaningTrifles[t]);r.whatWeDo.reverse(),o.whatWeDo=r.whatWeDo,r.whatWeDoNot.reverse();for(var t=0;t<r.whatWeDoNot.length;t++)t+1<=r.whatWeDoNot.length/2?o.whatWeDoNot.sideA.push(r.whatWeDoNot[t]):o.whatWeDoNot.sideB.push(r.whatWeDoNot[t]);e.content=o,console.log(e.content)},function(e){console.log(e)}),window.phone=c.checkSms}]),angular.module("becleanApp").controller("orderCheckoutController",["$scope","$timeout","$stateParams","$localStorage","$state",function(e,r,o,t,n){var c=function(){o.data.phone||t.general&&t.general.phone?e.general=o.data||t.general:n.go("home")};e.price={window:{cost:50},roller:{cost:40},balcon:{cost:150},frost:{cost:100},kitchen:{cost:200},svch:{cost:50},plates:{cost:100},oven:{cost:100},extract:{cost:100}},e.eraseErrors=function(){e.error=!1},e.tplOnload=function(){if($("#datepicker").length){var o=$("#datepicker"),t=new Date;$.datepicker.regional.ru={closeText:"Закрыть",prevText:"&#x3c;Пред",nextText:"След&#x3e;",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],firstDay:1,isRTL:!1},$.datepicker.setDefaults($.datepicker.regional.ru),o.datepicker({dateFormat:"dd-mm-yy",changeMonth:!0,showWeek:!0,minDate:new Date(t.getTime()+864e5),onSelect:function(){e.general.checkout.date=o.datepicker({dateFormat:"dd-mm-yy"}).val(),e.$$phase||e.$apply()}}),r(function(){o.datepicker("setDate","1"),e.general.checkout.date=o.datepicker({dateFormat:"dd-mm-yy"}).val(),e.$$phase||e.$apply()},1e3)}$("#selectmenu").length&&$("#selectmenu").selectmenu({classes:{"ui-selectmenu":"highlight"},select:function(r,o){e.general.checkout.time=o.item.value,e.$$phase||e.$apply()}})},e.clickIconHandler=function(r,o){2==arguments.length&&o>0?e.general.checkout.service[r]=0:o>=4||e.general.checkout.service[r]>=4?e.general.checkout.service[r]=4:e.general.checkout.service[r]++},e.decrement=function(r){e.general.checkout.service[r]>0?e.general.checkout.service[r]--:e.general.checkout.service[r]=0},e.discount=function(r,o){$(r.currentTarget).hasClass("discount__item_active")||(e.general.checkout.discount=o)},e.goToConfirm=function(){return!e.general.checkout.address||e.general.checkout.address.length<5?void(e.error=!0):(t.general.checkout=e.general.checkout,void n.go("confirm",{data:e.general}))},e.tplOnload(),c(),e.general&&(e.general.checkout={service:{window:0,roller:0,balcon:0,frost:0,kitchen:0,svch:0,plates:0,oven:0,extract:0},discount:10})}]),angular.module("becleanApp").controller("orderConfirmController",["$scope","$stateParams","$localStorage","$state","HttpService",function(e,r,o,t,n){function c(e,r){var o=e.split("-");r=""!==r||r?r:0;var t=new Date;return t.setYear(o[2]),t.setMonth(o[1]-1),t.setDate(o[0]),t.setHours(r),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}var a=function(){r.data.phone||o.general&&o.general.phone?(e.general=r.data.phone?r.data:o.general,e.general.toSend={main:e.general.current,phone:e.general.phone,additional:e.general.checkout.service,address:e.general.checkout.address,date:c(e.general.checkout.date,e.general.checkout.time),total:(e.general.total.price+e.general.current.rooms*e.general.price.rooms+e.general.current.bathrooms*e.general.price.bathrooms+e.general.checkout.service.roller*e.price.roller.cost+e.general.checkout.service.balcon*e.price.balcon.cost+e.general.checkout.service.frost*e.price.frost.cost+e.general.checkout.service.svch*e.price.svch.cost+e.general.checkout.service.plates*e.price.plates.cost+e.general.checkout.service.oven*e.price.oven.cost+e.general.checkout.service.extract*e.price.extract.cost+e.general.checkout.service.kitchen*e.price.kitchen.cost+e.general.checkout.service.window*e.price.window.cost).toFixed(2),time:((e.general.total.time+e.general.current.rooms*e.general.time.rooms+e.general.current.bathrooms*e.general.time.bathrooms+e.general.checkout.service.roller*e.price.roller.time+e.general.checkout.service.balcon*e.price.balcon.time+e.general.checkout.service.frost*e.price.frost.time+e.general.checkout.service.svch*e.price.svch.time+e.general.checkout.service.plates*e.price.plates.time+e.general.checkout.service.oven*e.price.oven.time+e.general.checkout.service.extract*e.price.extract.time+e.general.checkout.service.kitchen*e.price.kitchen.time+e.general.checkout.service.window*e.price.window.time)/60).toFixed(2),discount:e.general.checkout.discount,payment:(e.general.total.price+e.general.current.rooms*e.general.price.rooms+e.general.current.bathrooms*e.general.price.bathrooms+e.general.checkout.service.roller*e.price.roller.cost+e.general.checkout.service.balcon*e.price.balcon.cost+e.general.checkout.service.frost*e.price.frost.cost+e.general.checkout.service.svch*e.price.svch.cost+e.general.checkout.service.plates*e.price.plates.cost+e.general.checkout.service.oven*e.price.oven.cost+e.general.checkout.service.extract*e.price.extract.cost+e.general.checkout.service.kitchen*e.price.kitchen.cost+e.general.checkout.service.window*e.price.window.cost)*(100-e.general.checkout.discount)/100}):t.go("home")};console.log("$scope.general",e.general),e.price?a():n.price().then(function(r){e.price=r,console.log(e.price),a()},function(e){console.error(e)}),e.goHome=function(){n.order(e.general.toSend).then(function(e){t.go("finish")},function(e){console.error(e)})}}]),angular.module("becleanApp").controller("SmsCtrl",["$scope","$state","$stateParams","$localStorage","HttpService",function(e,r,o,t,n){e.onlyNumbers=function(){e.password&&0!==e.password.length&&(e.password=e.password.replace(/[a-z]|[A-Z]|[а-я]|[А-Я]|\!|\@|\#|\$|\%|\^|\&|\*|\)|\(|\;|\.\,\?\<\>/,""))},e.checkSms=function(){return!e.password||4!==e.password.length||isNaN(e.password)?void(e.error=!0):void n.checkSms(o.data.phone||t.general.phone,e.password).then(function(n){if(n.error)e.error=!0,r.go("checkout",c),console.log(n.error);else{var c=o.data||t.general;r.go("checkout",c)}},function(e){console.log(e)})},e.eraseErrors=function(){e.error=!1}}]),angular.module("becleanApp").controller("FinishController",["$scope","$state",function(e,r){e.resources=["video/Coverr-Lulu.mp4","video/Coverr-Lulu.webm"],e.fullScreen=!0,e.muted=!0,e.zIndex="0",e.playInfo={},e.pausePlay=!0}]);